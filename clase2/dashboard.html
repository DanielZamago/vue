<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://unpkg.com/vue@3"></script>
     <!-- Compiled and minified CSS -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

     <!-- Compiled and minified JavaScript -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<body>
    <div id="contenedor"> 
        <div class="container">
            <form action="">
                <fieldset>

                    <legend class="flow-text">
                        Lista de usuarios
                    </legend>
        
                    <div class="container">
                        
                        <p class="flow-text">
                            Bienvenido: {{nameAuth}}
                        </p>
        
                        <button @click="logout" class="waves-effect waves-light btn-small color-red">
                            cerrar sesion
                        </button>
                        <br><br>
        
                    </div>
        
                    <div class="container">
                        <table class="table striped centered bordered">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Nombre de usuario</th>
                                    <th>Correo</th>
                                </tr>
                            </thead>
            
                            <tbody>
                               
                                <tr v-for="user in users">
                                    <td> {{ user.id }} </td> 
                                    <td> {{ user.name }} </td>
                                    <td> {{ user.username }} </td>
                                    <td> {{ user.email }} </td>
                                </tr>
                                <tr v-if="new_user != null">
                                    <td> {{ new_user.id }} </td> 
                                    <td> {{ new_user.name }} </td>
                                    <td> {{ new_user.username }} </td>
                                    <td> {{ new_user.email }} </td>
                                </tr>

                                
                            </tbody>
                        </table>
                    </div>

                    <div class="container">
                        <br><br>
                        <button @click="register" class="btn waves-effect waves-light">
                            Registrar nuevo usuario
                        </button>
                    </div>
                    
                </fieldset>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        const {createApp} = Vue;
        
        var app = createApp({
            data(){
                return {
                    users:null,
                    email: '',
                    password:'',
                    nameAuth: localStorage.getItem('name'),
                    new_user: JSON.parse(localStorage.getItem('new_user')),
                }
            },methods : {
                logout(e){
                    e.preventDefault();

                    //borrar info del localStorage
                    localStorage.removeItem('email');
                    localStorage.removeItem('name');
                    window.location="users.html"
                },
                register(e){
                    e.preventDefault();

                    window.location="registrar.html"
                },
            },
            mounted(){
                fetch('users.json')
                .then((res) => res.json())
                .then((json) => (this.users = json))
                .catch((err) => (console.log(err)))
            }

        }).mount('#contenedor')
    </script>
</body>
</html>